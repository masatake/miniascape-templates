# NOTE: /etc/sysconfig/network-scripts/ifdown-post check if
# /etc/resolv.conf.saved exists and change its behavior.
# So we have to save it w/ any suffixes other than '.save' added.
f=/etc/resolv.conf
if test -f $f; then
    test -f $f.saved || cp -f $f $f.saved
else
    touch $f.saved  # arrange empty file to compare w/ $f
fi
cat << EOF > $f
# This file was generated during kickstart installation.
# DO NOT EDIT THIS FILE MANUALLY.
# 
# NOTE: You should set 'PEERDNS=no' in /etc/sysconfig/network-scripts/ifcfg-*.
# See also: RHEL 6 Deployment Guide, 9.2. Interface Configuration Files:
# http://red.ht/Swi6Zp
domain {{ domain }}
search {% if domains is defined and domains %}{{ domains|join(' ') }}{% else %}{{ domain }}{% endif %}
EOF
{% for ns in nameservers -%}
echo "nameserver {{ ns.ip }}" >> $f;{% endfor %}
cp $f $f.static  # Make a backup for cases if NetworkManager force generate it.
